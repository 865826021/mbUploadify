!function(){var t=function(){return this.init.apply(this,arguments)};t.prototype={init:function(t){if(this.setConfig(t),this.file=this.options.file,this.max=this.options.maximum,this.size=this.options.size,this.type=this.options.type,this.cache={},!this.file)throw new Error("file does not exist!");if(!this.options.url)throw new Error("url cannot be empty!");if("undefined"==typeof FileReader)throw new Error("browser does not support FileReader!");this.max>1&&this.options.isMultiple?this.file.setAttribute("multiple",!0):this.file.removeAttribute("multiple"),this.bindEvent()},verify:function(t){var e=this.options.message,i=new RegExp("\\b"+this.type+"\\b");return t.size>this.size?e.size:i.test(t.type)===!1?e.type:this.options.isAllowSame||1!==this.cache[t.lastModified]?(this.cache[t.lastModified]=1,null):e.same},getUploadNum:function(){var t,e=0;for(t in this.cache)this.cache[t]&&e++;return e},bindEvent:function(){function t(){var t=this.files;if(t.length>e.max||e.getUploadNum()>=e.max)e.options.error(t,s.maximum);else for(var o=0;o<t.length;o++){var n=t[o],a=new FileReader,r=e.verify(n);if(r)e.options.error(n,r);else switch(e.options.rendAsType.toLowerCase()){case"string":a.readAsBinaryString(t[o]);break;case"text":a.readAsText(t[o]);break;default:a.readAsDataURL(t[o])}for(var l=0;l<i.length;l++)a.addEventListener(i[l],e.options[i[l]],!1);!function(t){a.addEventListener("error",function(i){e.options.error(t,r||s.other)},!1),a.addEventListener("load",function(i){e.ajaxUpload(t),e.options.load(i,t)})}(n)}e.options.isAllowSame&&(this.dataValue=this.value,this.value="")}var e=this,i=["abort","loadstart","progress","loadend"],s=e.options.message;this.file.addEventListener("change",t,!1)},setConfig:function(t){for(var e,i={file:"",type:"image",maximum:5,size:2097152,rendAsType:"url",uploadName:"",url:"",message:{type:"类型不对!",size:"文件太大",maximum:"上传文件数量太多!",same:"不能上传相同的文件!",other:"其它网络错误!"},isMultiple:!0,isAllowSame:!1,uploadSuccess:function(){},uploadFailed:function(){},uploadComplete:function(){}},s=["abort","error","loadstart","progress","load","loadend"],o=0,n=s.length;n>o;o++)i[s[o]]=function(){};for(e in t)i.hasOwnProperty(e)&&(i[e]=t[e]);this.options=i},ajaxUpload:function(t){var e=this,i=new XMLHttpRequest,s=new FormData;i.lastModified=t.lastModified,i.onreadystatechange=function(){var t=this.responseText;4==this.readyState&&(this.status<300&&this.status>=200?e.options.uploadSuccess.call(this,t):(e.cache[this.lastModified]=null,e.options.uploadFailed.call(this))),this.once||(this.once=!0,e.options.uploadComplete())},s.append(e.options.uploadName||e.file.name,t),i.open("POST",e.options.url,!0),i.send(s)}},window.mbUploadify=t}();